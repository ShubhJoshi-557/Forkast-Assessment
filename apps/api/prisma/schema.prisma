// This is your Prisma schema file.
// Learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id     Int     @id @default(autoincrement())
  email  String  @unique
  name   String?
  orders Order[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order {
  id             String      @id @default(uuid())
  userId         Int
  user           User        @relation(fields: [userId], references: [id])
  type           OrderType
  status         OrderStatus
  price          Decimal     @db.Decimal(18, 8)
  quantity       Decimal     @db.Decimal(18, 8)
  filledQuantity Decimal     @default(0) @db.Decimal(18, 8)
  buyTrades      Trade[]     @relation("BuyOrder")
  sellTrades     Trade[]     @relation("SellOrder")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([status, price, createdAt])
}

model Trade {
  id          String   @id @default(uuid())
  buyOrderId  String
  sellOrderId String
  quantity    Decimal  @db.Decimal(18, 8)
  price       Decimal  @db.Decimal(18, 8)
  buyOrder    Order    @relation("BuyOrder", fields: [buyOrderId], references: [id])
  sellOrder   Order    @relation("SellOrder", fields: [sellOrderId], references: [id])
  createdAt   DateTime @default(now())

  @@index([createdAt])
}

enum OrderType {
  BUY
  SELL
}

enum OrderStatus {
  OPEN
  PARTIALLY_FILLED
  FILLED
  CANCELLED
}